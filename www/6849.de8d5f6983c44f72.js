"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6849],{6849:(J,b,o)=>{o.r(b),o.d(b,{Tab1PageModule:()=>A});var l=o(6728),f=o(6814),v=o(95),T=o(3554),x=o(6809),M=o(5861),p=o(2574),h=o(553),t=o(6242),P=o(1675),j=o(2014);function C(n,d){if(1&n){const r=t.EpF();t.TgZ(0,"ion-item")(1,"a",17),t.NdJ("click",function(){const c=t.CHM(r).index,i=t.oxw(2);return t.KtG(i.ir(c))})("click",function(){t.CHM(r),t.oxw(2);const a=t.MAs(10);return t.KtG(a.dismiss())}),t._uU(2),t.qZA()()}if(2&n){const r=d.$implicit;t.xp6(2),t.Oqu(r)}}function y(n,d){if(1&n){const r=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"Buscando Viaje"),t.qZA(),t.TgZ(4,"ion-buttons",14)(5,"ion-button",15),t.NdJ("click",function(){t.CHM(r),t.oxw();const a=t.MAs(10);return t.KtG(a.dismiss())}),t._uU(6,"Cerrar"),t.qZA()()()(),t.TgZ(7,"ion-content")(8,"ion-list"),t.YNc(9,C,3,1,"ion-item",16),t.qZA()()}if(2&n){const r=t.oxw();t.xp6(9),t.Q6J("ngForOf",r.rutas)}}function O(n,d){if(1&n){const r=t.EpF();t.TgZ(0,"div",18)(1,"ion-button",19),t.NdJ("click",function(){t.CHM(r);const a=t.oxw();return t.KtG(a.tomarViaje())}),t._uU(2," Tomar viaje "),t.qZA()()}}const Z=[{path:"",component:(()=>{var n;class d{constructor(e,a){this.apiService=e,this.storage=a,this.lngFin=0,this.latFin=0,this.lat=-33.59813725425291,this.lng=-70.5782624941369,this.direccion="",this.rutas=[]}ngAfterViewInit(){this.constriurMapa()}ir(e){console.log("esta es la ruta seleccionada: "+this.rutas[e]);var c=[-70.57902808465514,-33.59778231829415],i=new p.Map({accessToken:h.N.mapboxKey,container:"mapbox",style:"mapbox://styles/mapbox/streets-v11",center:[c[0],c[1]],zoom:13});let g=[-74.5,40],s=[-74.45,40.1];g=c,s=[this.lngFin,this.latFin],console.log(s),this.imprimirCoordenadas=()=>[s[0],s[1]],(new p.Marker).setLngLat([c[0],c[1]]).addTo(i),(new p.Marker).setLngLat([s[0],s[1]]).addTo(i),fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${g[0]},${g[1]};${s[0]},${s[1]}?steps=true&geometries=geojson&access_token=${h.N.mapboxKey}`).then(u=>u.json()).then(u=>{var V=u.routes[0].geometry;i.on("load",function(){i.addLayer({id:"route",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:V}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3887be","line-width":5,"line-opacity":.75}})})}).catch(u=>{console.log(u)})}buscar(){this.rutas=[],fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${this.direccion}.json?access_token=${h.N.mapboxKey}`).then(e=>e.json()).then(e=>{var a=e;console.log(a.features);var c=a.features.length;console.log(c),c>0&&(this.lngFin=a.features[0].center[0],this.latFin=a.features[0].center[1]);for(let i=0;i<a.features.length;i++){const g=a.features[i].place_name;console.log(g),this.rutas.push(g+i),console.log(i+1+") Lng:"+a.features[i].center[0]+" Lat:"+a.features[i].center[1]),this.mostrarBotonTomarViaje()}}).catch(e=>{console.log(e)})}tomarViaje(){var e=this;const a=this.imprimirCoordenadas();var c=a[0],i=a[1];this.storage.get("user_id").then(function(){var g=(0,M.Z)(function*(s){null!==s?(e.apiService.getConductorById(s).subscribe(),e.viajeData={inicio_lat:-33.59778231829415,inicio_lon:-70.57902808465514,destino_lat:i,destino_lon:c,tarifa:1e3,metodo_pago:"efectivo",usuario_viaje:s,conductor:s},e.apiService.createViaje(e.viajeData).subscribe(m=>{console.log("Guardado correctamente:"+m)},m=>{console.log("error: "+m)})):console.error("No se pudo obtener el conductor de la sesi\xf3n.")});return function(s){return g.apply(this,arguments)}}())}mostrarBotonTomarViaje(){if(this.rutas.length>0){const e=document.createElement("button");e.innerText="Tomar viaje",e.addEventListener("click",this.tomarViaje.bind(this)),document.body.appendChild(e)}}constriurMapa(){this.mapa=new p.Map({accessToken:h.N.mapboxKey,container:"mapbox",style:"mapbox://styles/mapbox/streets-v12",zoom:13,center:[this.lng,this.lat]})}}return(n=d).\u0275fac=function(e){return new(e||n)(t.Y36(P.M),t.Y36(j.K))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tab1"]],decls:16,vars:3,consts:[[1,"row","form-container"],[1,"col-8","search-container"],["id","controles"],["placeholder","Buscar direcci\xf3n","mode","ios","color","#0000",3,"ngModel","ngModelChange"],[1,"col-4","button-container"],["id","modal-viajes",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-search"],["d","M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"],["trigger","modal-viajes",1,"modalViajes"],["modal",""],["scrollY","true",3,"fullscreen"],[1,"container"],["id","mapbox"],["class","tomar-viaje-container",4,"ngIf"],["slot","end"],[3,"click"],[4,"ngFor","ngForOf"],["type","btn",3,"click"],[1,"tomar-viaje-container"],["id","tomar-viaje-btn",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"ion-header")(1,"div",0)(2,"div",1)(3,"div",2)(4,"ion-searchbar",3),t.NdJ("ngModelChange",function(i){return a.direccion=i}),t.qZA()()(),t.TgZ(5,"div",4)(6,"ion-button",5),t.NdJ("click",function(){return a.buscar()}),t.O4$(),t.TgZ(7,"svg",6),t._UZ(8,"path",7),t.qZA()(),t.kcU(),t.TgZ(9,"ion-modal",8,9),t.YNc(11,y,10,1,"ng-template"),t.qZA()()()(),t.TgZ(12,"ion-content",10)(13,"div",11),t._UZ(14,"div",12),t.qZA(),t.YNc(15,O,3,0,"div",13),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngModel",a.direccion),t.xp6(8),t.Q6J("fullscreen",!0),t.xp6(3),t.Q6J("ngIf",a.rutas.length>0))},dependencies:[l.YG,l.Sm,l.W2,l.Gu,l.Ie,l.q_,l.VI,l.wd,l.sr,l.ki,l.j9,f.sg,f.O5,v.JJ,v.On],styles:['@import"https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css";@charset "UTF-8";a[_ngcontent-%COMP%]{text-decoration:none}.solicita-viaje[_ngcontent-%COMP%]{margin-top:10px}.container[_ngcontent-%COMP%]{height:100vh!important}#mapbox[_ngcontent-%COMP%]{height:100%!important;width:100%;position:absolute!important;top:0;left:0}.floating-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;color:#fff;border-radius:50%;padding:10px;z-index:999;cursor:pointer}.floating-button[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:inherit;display:flex;flex-direction:column;align-items:center;justify-content:center}.floating-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:5px}ion-header[_ngcontent-%COMP%]{padding:0;background-color:#dadada93;color:#000}.toolbar-container[_ngcontent-%COMP%]{display:none!important}#barraBuscar[_ngcontent-%COMP%]{padding:0;background-color:#e1f3ae89;color:#000;border:none}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.search-container[_ngcontent-%COMP%]{flex:8}.button-container[_ngcontent-%COMP%]{flex:2}#modal-viajes[_ngcontent-%COMP%]{border-radius:50%;padding:10px;box-shadow:0 4px 6px #00000047;z-index:999;cursor:pointer}#modal-viajes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:5px}#tomar-viaje-btn[_ngcontent-%COMP%]{position:fixed;top:90%;left:50%;transform:translate(-50%,-50%);z-index:999;width:80%;max-width:600px}']}),d})()},{path:"manejar",loadChildren:()=>o.e(5641).then(o.bind(o,5641)).then(n=>n.ManejarPageModule)},{path:"viajar",loadChildren:()=>o.e(7723).then(o.bind(o,7723)).then(n=>n.ViajarPageModule)},{path:"en-viaje",loadChildren:()=>o.e(5952).then(o.bind(o,5952)).then(n=>n.EnViajePageModule)},{path:"en-viaje-pasajero",loadChildren:()=>o.e(9478).then(o.bind(o,9478)).then(n=>n.EnViajePasajeroPageModule)},{path:"finalizar-viaje",loadChildren:()=>o.e(1022).then(o.bind(o,1022)).then(n=>n.FinalizarViajePageModule)}];let F=(()=>{var n;class d{}return(n=d).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[x.Bz.forChild(Z),x.Bz]}),d})(),A=(()=>{var n;class d{}return(n=d).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[l.Pc,f.ez,v.u5,T.e,F]}),d})()}}]);